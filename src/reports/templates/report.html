<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <title>Relatório GridScope</title>
    <style>
        @page {
            size: A4;
            margin: 1cm;
        }

        body {
            font-family: 'Arial', sans-serif;
            font-size: 9pt;
            color: #000;
            margin: 0;
            padding: 0;
        }

        /* Main Container Border */
        .page-border {
            border: 2px solid #000;
            height: 100%;
        }

        /* HEADER */
        .header-table {
            width: 100%;
            border-collapse: collapse;
            border-bottom: 2px solid #000;
        }

        .header-table td {
            border: 2px solid #000;
            padding: 10px;
            vertical-align: middle;
        }

        .logo-cell {
            width: 30%;
            text-align: center;
        }

        .logo-text {
            font-size: 24pt;
            font-weight: bold;
        }

        .logo-grid {
            color: #FFD700;
            /* Gold/Yellow */
        }

        .logo-scope {
            color: #000;
        }

        .logo-sub {
            font-size: 6pt;
            text-transform: uppercase;
            letter-spacing: 2px;
            margin-top: 5px;
            color: #555;
        }

        .title-cell {
            width: 40%;
            text-align: center;
            font-size: 14pt;
            font-weight: bold;
        }

        .info-cell {
            width: 30%;
            text-align: center;
            font-size: 8pt;
        }

        /* SECTION HEADERS */
        .section-header {
            background-color: #FFD700;
            color: #000;
            font-weight: bold;
            text-align: center;
            padding: 5px;
            border: 2px solid #000;
            border-top: none;
            font-size: 10pt;
        }

        /* DATA TABLES */
        .data-table {
            width: 100%;
            border-collapse: collapse;
            border: 2px solid #000;
            border-top: none;
            margin-bottom: 20px;
        }

        .data-table th,
        .data-table td {
            border: 1px solid #000;
            padding: 4px 8px;
            font-size: 9pt;
        }

        .data-table th {
            background-color: #fff;
            /* Headers in image are white except main section header */
            text-align: center;
            font-weight: normal;
        }

        .label-cell {
            background-color: #fff;
            font-weight: normal;
            width: 35%;
        }

        /* SPECIFIC TABLES STYLES */
        .asset-table td {
            border: 1px solid #000;
        }

        /* ALIGNMENT */
        .text-right {
            text-align: right;
        }

        .text-center {
            text-align: center;
        }

        .text-left {
            text-align: left;
        }

        /* CRITICALITY */
        .status-CRÍTICO {
            font-weight: bold;
            /* In the image, CRITICO didn't distinctively have color in the cell background, but text could be bold */
        }

        /* SPACING */
        .spacer {
            height: 10px;
            border-left: 2px solid #000;
            border-right: 2px solid #000;
        }
    </style>
</head>

<body>

    <div class="page-border">
        <!-- HEADER -->
        <table class="header-table">
            <tr>
                <td class="logo-cell">
                    {% if pdf_data.logo_b64 %}
                    <img src="data:image/png;base64,{{ pdf_data.logo_b64 }}" alt="GridScope"
                        style="max-height: 50px; max-width: 100%;">
                    {% else %}
                    <div class="logo-text">
                        <span class="logo-grid">Grid</span><span class="logo-scope">Scope</span>
                        <span style="font-size:18pt;">⚡</span>
                    </div>
                    {% endif %}
                    <div class="logo-sub">Dados. Equilibrio. Futuro.</div>
                </td>
                <td class="title-cell">
                    Relatório de Exportação de Dados
                </td>
                <td class="info-cell">
                    <strong>Nº Relatório</strong><br>
                    {{ pdf_data.header.report_number }}
                </td>
            </tr>
        </table>

        <!-- ASSET IDENTIFICATION -->
        <div class="section-header">Identificação do Ativo (Subestação)</div>
        <table class="data-table asset-table">
            <tr>
                <td class="label-cell">Subestação</td>
                <td class="text-right">{{ pdf_data.header.substation_name }}</td>
            </tr>
            <tr>
                <td class="label-cell">Alimentador</td>
                <td class="text-right">{{ pdf_data.header.feeder_id }}</td>
            </tr>
            <tr>
                <td class="label-cell">Bairro / Região</td>
                <td class="text-right">{{ pdf_data.header.neighborhood }}</td>
            </tr>
            <tr>
                <td class="label-cell">Área Coberta</td>
                <td class="text-right">{{ pdf_data.header.covered_area_km2 }}</td>
            </tr>
            <tr>
                <td class="label-cell">Total de clientes conectadas</td>
                <td class="text-right">{{ pdf_data.header.total_clients }}</td>
            </tr>
        </table>

        <!-- CONSUMPTION -->
        <div class="section-header">Consumo por Classe</div>
        <table class="data-table">
            <thead>
                <tr>
                    <th class="text-left">Classe</th>
                    <th>Energia Consumida (MWh/mês)</th>
                    <th>% do Total</th>
                </tr>
            </thead>
            <tbody>
                {% for index, row in pdf_data.consumption.iterrows() %}
                <tr>
                    <td>{{ row['class'] }}</td>
                    <td class="text-center">{{ "{:,.0f}".format(row['energy_mwh']).replace(',', '.') }}</td>
                    <td class="text-center">{{ "{:.0f}%".format(row['percentage']) }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>

        <!-- DISTRIBUTED GENERATION -->
        <div class="section-header">Geração Distribuída por Classe</div>
        <table class="data-table">
            <thead>
                <tr>
                    <th class="text-left">Classe</th>
                    <th>Potência GD Instalada (kW)</th>
                    <th>Quantidade de Clientes</th>
                </tr>
            </thead>
            <tbody>
                {% for index, row in pdf_data.gd.iterrows() %}
                <tr>
                    <td>{{ row['class'] }}</td>
                    <td class="text-center">{{ "{:,.0f}".format(row['power_kw']).replace(',', '.') }}</td>
                    <td class="text-center">{{ row['count'] }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>

        <!-- COMPARISON -->
        <div class="section-header">Comparação da Subestação vs Total da Cidade</div>
        <table class="data-table">
            <thead>
                <tr>
                    <th style="width: 10%;">Categoria</th>
                    <th style="width: 25%;">Indicador</th>
                    <th>Subestação (SE)</th>
                    <th>Total Cidade</th>
                    <th>% da Cidade</th>
                    <th>Média da Cidade</th>
                </tr>
            </thead>
            <tbody>
                {% for index, row in pdf_data.indicators.iterrows() %}
                <tr>
                    <td class="text-center">{{ row['category'] }}</td>
                    <td>{{ row['indicator'] }}</td>
                    <td class="text-center">{{ row['substation'] }}</td>
                    <td class="text-center">{{ row['total_city'] }}</td>
                    <td class="text-center">{{ row['pct_city'] }}</td>
                    <td class="text-center">{{ row['avg_city'] }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>

        <!-- RANKING -->
        <div class="section-header">Ranking das Subestações</div>
        <table class="data-table">
            <thead>
                <tr>
                    <th>Posição</th>
                    <th>ID</th>
                    <th>Subestações</th>
                    <th>Capacidade (MW)</th>
                    <th>Clientes</th>
                    <th>MMGD</th>
                    <th>Criticidade</th>
                </tr>
            </thead>
            <tbody>
                {% for index, row in pdf_data.ranking.iterrows() %}
                <tr>
                    <td class="text-center">{{ row['position'] }}</td>
                    <td class="text-center">{{ row['id'] }}</td>
                    <td class="text-center">{{ row['name'] }}</td>
                    <td class="text-center">{{ row['capacity_mw'] }}</td>
                    <td class="text-center">{{ row['clients'] }}</td>
                    <td class="text-center">{{ row['mmgd'] }}</td>
                    <td class="text-center status-{{ row['criticality'] }}">{{ row['criticality'] }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>

        <!-- DIAGNOSTIC (Future) -->
        <div class="section-header">Diagnóstico da Ferramenta</div>
        <div style="border: 2px solid #000; border-top: none; height: 100px; padding: 10px;">
            <!-- Reserved for future AI conclusion -->
        </div>

    </div>

</body>

</html>